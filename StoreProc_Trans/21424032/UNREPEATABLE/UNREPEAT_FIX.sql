CREATE 
--ALTER
PROC USP_21424032_READ_DATA_CONTRACT_Fix
AS
BEGIN TRAN
	SET TRAN ISOLATION LEVEL REPEATABLE READ
	BEGIN TRY
	
	SELECT SUM(CT.Fee) AS SLHOPDONG FROM Contract CT

	WAITFOR DELAY '00:00:05'
	

	SELECT * FROM Contract

	
	
	END TRY
	BEGIN CATCH
		PRINT N'LỖI HỆ THỐNG'
		ROLLBACK TRAN
		RETURN 1	
	END CATCH
COMMIT TRAN
RETURN 0
GO

CREATE 
--ALTER
PROC USP_21424032_WRITE_DATA_CONTRACT_Fix
	@CONTRACT_ID BIGINT
AS
BEGIN TRAN
	BEGIN TRY

		if not exists (select * from Contract where ID = @CONTRACT_ID)
		begin
			print N'Hợp đồng không tồn tại'
			rollback tran
			return 1
		end


		DELETE FROM Contract WHERE ID = @CONTRACT_ID
		

	END TRY
	BEGIN CATCH
		PRINT N'LỖI HỆ THỐNG'
		ROLLBACK TRAN
		RETURN 1
	END CATCH
COMMIT TRAN
RETURN 0
GO
